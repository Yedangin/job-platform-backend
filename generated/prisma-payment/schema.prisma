datasource db {
  provider = "postgresql"
  url      = env("PAYMENT_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../../generated/prisma-payment"
}

model ServiceProduct {
  productId       Int                  @id @default(autoincrement()) @map("product_id")
  productCode     String               @unique @map("product_code")
  productName     String               @map("product_name")
  productCategory String               @map("product_category")
  isActive        Boolean              @default(true) @map("is_active")
  pricingRules    ProductPricingRule[]

  @@map("service_products")
}

model ProductPricingRule {
  ruleId        BigInt         @id @default(autoincrement()) @map("rule_id")
  productId     Int            @map("product_id")
  product       ServiceProduct @relation(fields: [productId], references: [productId])
  originalPrice Decimal        @map("original_price") @db.Decimal(12, 0)
  salePrice     Decimal        @map("sale_price") @db.Decimal(12, 0)
  validFrom     DateTime       @map("valid_from")
  validUntil    DateTime?      @map("valid_until")

  @@map("product_pricing_rules")
}

model Order {
  orderId         BigInt      @id @default(autoincrement()) @map("order_id")
  corporateId     BigInt      @map("corporate_id")
  totalSaleAmount Decimal     @map("total_sale_amount") @db.Decimal(12, 0)
  status          String      @default("PENDING")
  createdAt       DateTime    @default(now()) @map("created_at")
  items           OrderItem[]

  @@map("orders")
}

model OrderItem {
  itemId    BigInt @id @default(autoincrement()) @map("item_id")
  orderId   BigInt @map("order_id")
  order     Order  @relation(fields: [orderId], references: [orderId])
  productId Int    @map("product_id")

  snapProductName String  @map("snap_product_name")
  snapSalePrice   Decimal @map("snap_sale_price") @db.Decimal(12, 0)

  @@map("order_items")
}

model PointLedger {
  ledgerId        BigInt   @id @default(autoincrement()) @map("ledger_id")
  corporateId     BigInt   @map("corporate_id")
  amount          Int      @map("amount")
  balanceSnapshot Int      @map("balance_snapshot")
  createdAt       DateTime @default(now()) @map("created_at")

  @@map("point_ledger")
}

model CorporateCoupon {
  couponId    BigInt   @id @default(autoincrement()) @map("coupon_id")
  corporateId BigInt   @map("corporate_id")
  couponType  String   @map("coupon_type")
  status      String   @default("ACTIVE")
  expiresAt   DateTime @map("expires_at")

  @@map("corporate_coupons")
}
