datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../../generated/prisma-user"
}

model User {
  id       String  @id @default(cuid())
  email    String? @unique
  password String?

  // [중요] fullName이 있어야 전략(Strategy) 파일 에러가 안 납니다.
  fullName String? @map("full_name")

  userType UserType @default(INDIVIDUAL) @map("user_type")

  corporate   CorporateProfile?
  individual  IndividualProfile?
  socialAuths SocialAuth[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

enum UserType {
  CORPORATE
  INDIVIDUAL
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

model CorporateProfile {
  companyId     BigInt @id @default(autoincrement()) @map("company_id")
  userId        String @unique @map("user_id")
  user          User   @relation(fields: [userId], references: [id])
  companyName   String @map("company_name")
  industryCode  String @map("industry_code")
  businessRegNo String @map("business_reg_no")

  accessLogs TalentAccessLog[]

  @@map("profiles_corporate")
}

model IndividualProfile {
  individualId   BigInt  @id @default(autoincrement()) @map("individual_id")
  userId         String  @unique @map("user_id")
  user           User    @relation(fields: [userId], references: [id])
  fullName       String  @map("full_name")
  visaStatus     String  @map("visa_status")
  isVisaVerified Boolean @default(false) @map("is_visa_verified")
  koreanLevel    Int     @default(0) @map("korean_level")

  accessLogs TalentAccessLog[]

  @@map("profiles_individual")
}

model TalentAccessLog {
  accessId     BigInt            @id @default(autoincrement()) @map("access_id")
  corporateId  BigInt            @map("corporate_id")
  corporate    CorporateProfile  @relation(fields: [corporateId], references: [companyId])
  individualId BigInt            @map("individual_id")
  individual   IndividualProfile @relation(fields: [individualId], references: [individualId])
  accessedAt   DateTime          @default(now()) @map("accessed_at")

  @@unique([corporateId, individualId])
  @@map("talent_access_logs")
}

model SocialAuth {
  id         String         @id @default(cuid())
  userId     String         @map("user_id")
  user       User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  provider   SocialProvider
  providerId String         @map("provider_id")

  @@unique([provider, providerId])
  @@map("social_auths")
}

enum SocialProvider {
  GOOGLE
  FACEBOOK
  KAKAO
  APPLE
}
