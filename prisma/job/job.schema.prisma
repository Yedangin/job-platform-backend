datasource db {
  provider = "postgresql"
  url      = env("JOB_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "windows", "darwin-arm64", "debian-openssl-3.0.x"]
  output   = "../../generated/prisma-job"
}

model IndustryVisaRule {
  id           Int      @id @default(autoincrement())
  industryCode String   @map("industry_code")
  allowedVisa  String   @map("allowed_visa")
  
  @@unique([industryCode, allowedVisa])
  @@map("industry_visa_rules")
}

model JobPosting {
  jobId            BigInt        @id @default(autoincrement()) @map("job_id")
  corporateId      BigInt        @map("corporate_id")
  
  boardType        BoardType     @map("board_type")
  title            String
  description      String        @db.Text
  workContentImg   String?       @map("work_content_img")
  
  status           PostStatus    @default(OPEN)
  isPremium        Boolean       @default(false) @map("is_premium")
  premiumStartAt   DateTime?     @map("premium_start_at")
  premiumEndAt     DateTime?     @map("premium_end_at")
  closingDate      DateTime?     @map("closing_date")
  isRecruitmentEnd Boolean       @default(false) @map("is_recruitment_end")
  
  displayAddress   String        @map("display_address")
  actualAddress    String        @map("actual_address")
  workIntensity    Intensity     @default(MIDDLE) @map("work_intensity")
  benefits         Json?         @map("benefits_json")

  allowedVisas     String        @map("allowed_visas")
  minKoreanLevel   Int           @default(0) @map("min_korean_level")
  fulltimeVisaResult Json?       @map("fulltime_visa_result")

  contactName      String        @map("contact_name")
  contactPhone     String        @map("contact_phone")
  interviewMethod  InterviewType @default(OFFLINE) @map("interview_method")
  interviewPlace   String?       @map("interview_place")

  albaAttributes     JobAttributesAlba?
  fulltimeAttributes JobAttributesFulltime?
  interviewSlots     InterviewSlot[]
  applications       JobApplication[]

  @@map("job_postings")
}

model JobAttributesAlba {
  jobId         BigInt      @id @map("job_id")
  job           JobPosting  @relation(fields: [jobId], references: [jobId], onDelete: Cascade)
  hourlyWage    Int         @map("hourly_wage")
  workPeriod    String?     @map("work_period")
  workDaysMask  String      @map("work_days_mask") 
  workTimeStart DateTime?   @db.Time @map("work_time_start")
  workTimeEnd   DateTime?   @db.Time @map("work_time_end")

  @@map("job_attributes_alba")
}

model JobAttributesFulltime {
  jobId              BigInt         @id @map("job_id")
  job                JobPosting     @relation(fields: [jobId], references: [jobId], onDelete: Cascade)
  salaryMin          Int?           @map("salary_min")
  salaryMax          Int?           @map("salary_max")
  experienceLevel    String         @map("experience_level")
  educationLevel     String         @map("education_level")
  occupationCode     String         @map("occupation_code")
  preferredMajors    Json?          @map("preferred_majors")
  overseasHireWilling Boolean       @default(false) @map("overseas_hire_willing")

  @@map("job_attributes_fulltime")
}

model InterviewSlot {
  slotId       BigInt     @id @default(autoincrement()) @map("slot_id")
  jobId        BigInt     @map("job_id")
  job          JobPosting @relation(fields: [jobId], references: [jobId])
  startTime    DateTime   @map("start_time")
  endTime      DateTime   @map("end_time")
  isBooked     Boolean    @default(false) @map("is_booked")

  @@map("interview_slots")
}

model JobApplication {
  appId            BigInt            @id @default(autoincrement()) @map("app_id")
  jobId            BigInt            @map("job_id")
  job              JobPosting        @relation(fields: [jobId], references: [jobId])
  applicantId      BigInt            @map("applicant_id")
  
  status           ApplicationStatus @default(PENDING)
  
  selectedSlotId   BigInt?           @map("selected_slot_id")
  proposedBy       ActorType?        @map("proposed_by")
  proposedTime     DateTime?         @map("proposed_time") 
  
  rejectionReason  String?           @map("rejection_reason")
  createdAt        DateTime          @default(now()) @map("created_at")
  updatedAt        DateTime          @updatedAt @map("updated_at")

  @@map("job_applications")
}

enum BoardType {
  PART_TIME
  FULL_TIME
}

enum PostStatus {
  OPEN
  CLOSED
}

enum Intensity {
  UPPER
  MIDDLE
  LOWER
}

enum InterviewType {
  OFFLINE
  ONLINE
}

enum ApplicationStatus { 
  PENDING
  INTERVIEW_REQUESTED
  COORDINATION_NEEDED
  CONFIRMED
  REJECTED
  CANCELLED
}

enum ActorType {
  EMPLOYER
  APPLICANT
}