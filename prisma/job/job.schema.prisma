// Job Domain Schema - PostgreSQL
// Includes: job_posts, categories, applies, reviews, reports, interviews

datasource jobDB {
  provider = "postgresql"
  url      = env("JOB_DATABASE_URL")
}

generator jobClient {
  provider = "prisma-client-js"
  output   = "../generated/prisma-job"
}

enum JobPostStatus {
  PENDING
  APPROVED
  REJECTED
}

enum AppliedStatus {
  PENDING
  CONFIRMED
  INTERVIEW
  SUCCESS
  REJECTED
}

enum InterviewStatus {
  PENDING
  STARTING
  SUCCESS
  REJECTED
  PENALTY
}

model Category {
  id               String     @id @default(cuid()) @map("id")
  name             String?    @jobDB.VarChar(50)
  description      String?    @jobDB.VarChar(255)
  parentCategoryId String?    @map("parent_category_id")
  parent           Category?  @relation("CategoryHierarchy", fields: [parentCategoryId], references: [id])
  children         Category[] @relation("CategoryHierarchy")
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")

  jobPosts JobPost[]

  @@index([name])
  @@map("categories")
}

model JobPost {
  id           String        @id @default(cuid()) @map("id")
  corporateId  String        @map("corporate_id")
  title        String?       @jobDB.VarChar(255)
  description  String?       @jobDB.Text
  location     String?       @jobDB.VarChar(255)
  salaryRange  String?       @map("salary_range") @jobDB.VarChar(255)
  categoryId   String?       @map("category_id")
  feeType      String?       @map("fee_type") @jobDB.VarChar(50)
  status       JobPostStatus @default(PENDING)
  approvedBy   String?       @map("approved_by")
  appliesCount Int?          @default(0) @map("applies_count")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  expiredAt    DateTime?     @map("expired_at")

  category   Category?   @relation(fields: [categoryId], references: [id])
  applies    Apply[]
  interviews Interview[]

  @@index([categoryId])
  @@index([title, description], name: "Job Search")
  @@index([corporateId])
  @@index([feeType])
  @@map("job_posts")
}

model Apply {
  id         String        @id @default(cuid()) @map("id")
  jobPostId  String        @map("job_post_id")
  userId     String        @map("user_id")
  userInfoId String?       @map("user_info_id")
  isReviewed Boolean       @default(false) @map("is_reviewed")
  status     AppliedStatus @default(PENDING)
  appliedAt  DateTime      @default(now()) @map("applied_at")

  jobPost JobPost @relation(fields: [jobPostId], references: [id])

  @@index([status])
  @@index([jobPostId])
  @@map("applies")
}

model Interview {
  id            String          @id @default(cuid()) @map("id")
  jobPostId     String          @map("job_post_id")
  memberId      String          @map("member_id")
  corporateId   String          @map("corporate_id")
  roomId        String?         @map("room_id")
  interviewDate DateTime?       @map("interview_date")
  status        InterviewStatus @default(PENDING)
  failureReason String?         @map("failure_reason") @jobDB.VarChar(255)
  createdAt     DateTime        @default(now()) @map("created_at")
  updatedAt     DateTime        @updatedAt @map("updated_at")

  jobPost JobPost  @relation(fields: [jobPostId], references: [id])
  reviews Review[]

  @@index([interviewDate])
  @@index([status])
  @@index([failureReason])
  @@index([memberId])
  @@index([jobPostId])
  @@index([corporateId])
  @@index([createdAt])
  @@map("interviews")
}

model Review {
  id          String   @id @default(cuid()) @map("id")
  interviewId String   @map("interview_id")
  reviewerId  String   @map("reviewer_id")
  rating      Int?
  comment     String?  @jobDB.Text
  createdAt   DateTime @default(now()) @map("created_at")

  interview Interview @relation(fields: [interviewId], references: [id])

  @@index([rating])
  @@index([interviewId])
  @@index([reviewerId])
  @@index([createdAt])
  @@map("reviews")
}

model Report {
  id             String   @id @default(cuid()) @map("id")
  title          String?  @jobDB.VarChar(255)
  reporterId     String   @map("reporter_id")
  reportedUserId String   @map("reported_user_id")
  reason         String?  @jobDB.Text
  status         String?  @jobDB.VarChar(50)
  createdAt      DateTime @default(now()) @map("created_at")

  @@index([status])
  @@index([reason])
  @@index([createdAt])
  @@map("reports")
}
