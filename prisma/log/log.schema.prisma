// Log Domain Schema - MongoDB
// Includes: system_logs

datasource logDB {
  provider = "mongodb"
  url      = env("LOG_MONGODB_URL")
}

generator logClient {
  provider = "prisma-client-js"
  output   = "../../generated/prisma-log"
  // binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

model SystemLog {
  id          String   @id @default(auto()) @map("_id") @logDB.ObjectId
  userId      String?  @map("user_id")
  actionType  String?  @map("action_type") @logDB.String
  description String?  @logDB.String
  createdAt   DateTime @default(now()) @map("created_at")

  @@index([actionType])
  @@index([createdAt])
  @@map("system_logs")
}

model AuditLog {
  id           String   @id @default(auto()) @map("_id") @logDB.ObjectId
  service      String   @map("service") @logDB.String
  userId       String?  @map("user_id")
  action       String   @map("action") @logDB.String
  resource     String?  @map("resource") @logDB.String
  resourceId   String?  @map("resource_id")
  method       String?  @map("method") @logDB.String
  endpoint     String?  @map("endpoint") @logDB.String
  statusCode   Int?     @map("status_code")
  ipAddress    String?  @map("ip_address")
  userAgent    String?  @map("user_agent")
  requestId    String?  @map("request_id")
  sessionId    String?  @map("session_id")
  metadata     Json?    @map("metadata")
  oldValues    Json?    @map("old_values")
  newValues    Json?    @map("new_values")
  duration     Int?     @map("duration") // in milliseconds
  success      Boolean  @default(true) @map("success")
  errorMessage String?  @map("error_message")
  createdAt    DateTime @default(now()) @map("created_at")

  @@index([service])
  @@index([userId])
  @@index([action])
  @@index([resource])
  @@index([createdAt])
  @@index([success])
  @@map("audit_logs")
}
